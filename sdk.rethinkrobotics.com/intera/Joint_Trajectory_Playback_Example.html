<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">

<!-- Mirrored from sdk.rethinkrobotics.com/intera/Joint_Trajectory_Playback_Example by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 18 Oct 2019 05:04:01 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="UTF-8"/>
<title>Joint Trajectory Playback Example - Intera SDK</title>
<script>document.documentElement.className = document.documentElement.className.replace( /(^|\s)client-nojs(\s|$)/, "$1client-js$2" );</script>
<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"Joint_Trajectory_Playback_Example","wgTitle":"Joint Trajectory Playback Example","wgCurRevisionId":1171,"wgRevisionId":1171,"wgArticleId":67,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Joint_Trajectory_Playback_Example","wgRelevantArticleId":67,"wgRequestId":"5ec555accef1845a6de10137","wgIsProbablyEditable":false,"wgRelevantPageIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[]});mw.loader.state({"site.styles":"ready","noscript":"ready","user.styles":"ready","user":"ready","site":"ready","user.options":"ready","user.tokens":"loading","ext.pygments":"ready","mediawiki.legacy.shared":"ready","mediawiki.legacy.commonPrint":"ready","mediawiki.sectionAnchor":"ready","skins.cavendishrr":"ready"});mw.loader.implement("user.tokens@09sx7ae",function($,jQuery,require,module){/*@nomin*/mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});
});mw.loader.load(["mediawiki.page.startup","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.toc","mediawiki.searchSuggest","cavendishrr.js","app.js"]);});</script>
<link rel="stylesheet" href="a/load8c61.css?debug=false&amp;lang=en&amp;modules=ext.pygments%7Cmediawiki.legacy.commonPrint%2Cshared%7Cmediawiki.sectionAnchor%7Cskins.cavendishrr&amp;only=styles&amp;skin=cavendishrr"/>
<script async="" src="a/loada191.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=cavendishrr"></script>
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Roboto:300,300italic,400,500,500italic,700|Roboto+Condensed:300,700|Open+Sans:300"/>
<meta name="ResourceLoaderDynamicStyles" content=""/>
<link rel="stylesheet" href="a/load8ac3.css?debug=false&amp;lang=en&amp;modules=site.styles&amp;only=styles&amp;skin=cavendishrr"/>
<meta name="generator" content="MediaWiki 1.31.0"/>
<link rel="shortcut icon" href="../favicon.ico"/>
<link rel="search" type="application/opensearchdescription+xml" href="a/opensearch_desc.php" title="Intera SDK (en)"/>
<link rel="EditURI" type="application/rsd+xml" href="a/api-result251f.xml?action=rsd"/>
<link rel="alternate" type="application/atom+xml" title="Intera SDK Atom feed" href="a/feeda295.xml?title=Special:RecentChanges&amp;feed=atom"/>
<!--[if lt IE 9]><script src="/intera/a/load.php?debug=false&amp;lang=en&amp;modules=html5shiv&amp;only=scripts&amp;skin=CavendishRR&amp;sync=1"></script><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Joint_Trajectory_Playback_Example rootpage-Joint_Trajectory_Playback_Example skin-cavendishrr action-view"><div id="container"><!-- start fragment header -->
    <div id="header" class="noprint">
            <a name="top" id="contentTop"></a>

            <!-- Logo + site name -->
            <h1>
                <a href="Main_Page.html" style="text-indent: 2em; width: 123px; height: 69px; background: transparent url(a/skins/CavendishRR/styles/images/header_logo.png) no-repeat scroll;" title="Visit the main page">&nbsp;</a>            </h1>

            <div id="rr_ActionWrap">
                <!-- Account action links -->
                <div id="accountActions"><a href="http://sdk-accounts.rethinkrobotics.com/public/NewUser">Create account</a><a href="a/indexc61c.html?title=Special:UserLogin&amp;returnto=Joint+Trajectory+Playback+Example">Log in</a></div>                <!-- Search box -->
                        <form action="http://sdk.rethinkrobotics.com/intera/a/index.php" id="searchform">
            <label for="searchInput">Search</label>
            <input type='hidden' name="title" value="Special:Search"/>
            <input type="search" name="search" placeholder="Search Intera SDK" title="Search Intera SDK [f]" accesskey="f" id="searchInput"/>
                            <button type="submit" name="button">Search</button>        </form>
                </div><!--/#rr_ActionWrap-->
    </div> <!-- End header div -->
<!-- end fragment header --><div id="mBody"><!-- start fragment mainContent -->
<!-- start fragment firstHeader -->
<div id="firstHeadingDiv" class="firstHeading">
    <div class="l-container">
        <!-- Content action buttons -->
                <ul class="m-cactions">
            <li><a href="#">More</a>
                <ul>
                <li id="ca-viewsource"><a href="a/index1285.html?title=Joint_Trajectory_Playback_Example&amp;action=edit" title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></li><li id="ca-history"><a href="a/indexafef.html?title=Joint_Trajectory_Playback_Example&amp;action=history" title="Past revisions of this page [h]" accesskey="h">History</a></li>                </ul>
            </li>

            <li id="ca-nstab-main" class="selected"><a href="Joint_Trajectory_Playback_Example.html" title="View the content page [c]" accesskey="c">Page</a></li>        </ul>
        
        <h1 lang="en">
            <span dir="auto">Joint Trajectory Playback Example</span>
        </h1>
    </div><!--/.l-container-->
</div><!--/#firstHeadingDiv-->
<!-- end fragment firstHeader -->
<div class="bg-wrapper clearfix">
    <!-- start fragment sidebar -->
    <div id="side" class="noprint" > <!-- cavendishmw: s/column-one/side/ -->
        <ul id="nav">
                  <li>
          <span>Installation &amp; Configuration</span>

                    <ul class="collapsible-collapsed">
                                    <li id="n-Robot-Setup"><a href="Robot_Setup.html">Robot Setup</a></li>                                    <li id="n-Workstation-Setup"><a href="Workstation_Setup.html">Workstation Setup</a></li>                                    <li id="n-Networking"><a href="Networking.html">Networking</a></li>                                    <li id="n-Hello-Robot.21"><a href="Hello_Robot.html">Hello Robot!</a></li>                                    <li id="n-Hardware-Components"><a href="Hardware_Components.html">Hardware Components</a></li>                                    <li id="n-SDK-Workstation-Requirements"><a href="System_requirements.html">SDK Workstation Requirements</a></li>                                    <li id="n-Robot-Workspace-Guidelines"><a href="Workspace_Guidelines.html">Robot Workspace Guidelines</a></li>                                    <li id="n-Field-Service-Menu-.28FSM.29"><a href="Field_Service_Menu_(FSM).html">Field Service Menu (FSM)</a></li>                                    <li id="n-Time-and-NTP"><a href="Time_and_NTP.html">Time and NTP</a></li>                                    <li id="n-SDK-Software-Update"><a href="Software_Update.html">SDK Software Update</a></li>                                    <li id="n-SDK-Release-Notes"><a href="Release-Changes.html">SDK Release Notes</a></li>                            </ul>
                </li>
          <li>
          <span>Concepts</span>

                    <ul class="collapsible-collapsed">
                                    <li id="n-SDK-Robot-Workstation-Overview"><a href="SDK_System_Overview.html">SDK Robot-Workstation Overview</a></li>                                    <li id="n-E-STOP-and-Enable-Robot"><a href="E-STOP_and_Enable_Robot.html">E-STOP and Enable Robot</a></li>                                    <li id="n-Arm-Calibration"><a href="Arm_Calibration.html">Arm Calibration</a></li>                                    <li id="n-Arm-Control-Systems"><a href="Arm_Control_Systems.html">Arm Control Systems</a></li>                                    <li id="n-API-Reference"><a href="API_Reference.html">API Reference</a></li>                            </ul>
                </li>
          <li>
          <span>Tutorials</span>

                    <ul class="collapsible-collapsed">
                                    <li id="n-Interaction-Control-Tutorial"><a href="Interaction_Control_Tutorial.html">Interaction Control Tutorial</a></li>                                    <li id="n-Motion-Interface-Tutorial"><a href="Motion_Interface_Tutorial.html">Motion Interface Tutorial</a></li>                                    <li id="n-MoveIt.21-Tutorial"><a href="MoveIt_Tutorial.html">MoveIt! Tutorial</a></li>                                    <li id="n-Gazebo-Tutorial"><a href="Gazebo_Tutorial.html">Gazebo Tutorial</a></li>                            </ul>
                </li>
          <li>
          <span>Code Examples</span>

                    <ul class="collapsible-collapsed">
                                    <li id="n-Running-Examples-Overview"><a href="Running_Examples_Overview.html">Running Examples Overview</a></li>                                    <li id="n-Camera-Image-Display-Example"><a href="Camera_Image_Display_Example.html">Camera Image Display Example</a></li>                                    <li id="n-Gripper-Example"><a href="Gripper_Example.html">Gripper Example</a></li>                                    <li id="n-Gripper-Cuff-Control-Example"><a href="Gripper_Cuff_Control_Example.html">Gripper Cuff Control Example</a></li>                                    <li id="n-Head-Display-Image-Example"><a href="Head_Display_Image_Example.html">Head Display Image Example</a></li>                                    <li id="n-Head-Movement-Example"><a href="Head_Movement_Example.html">Head Movement Example</a></li>                                    <li id="n-Lights-Blinking-Example"><a href="Lights_Blinking_Example.html">Lights Blinking Example</a></li>                                    <li id="n-IK-Service-Example"><a href="IK_Service_Example.html">IK Service Example</a></li>                                    <li id="n-Joint-Position-Example"><a href="Joint_Position_Example.html">Joint Position Example</a></li>                                    <li id="n-Joint-Position-Waypoint-Example"><a href="Joint_Position_Waypoint_Example.html">Joint Position Waypoint Example</a></li>                                    <li id="n-Joint-Torque-Springs-Example"><a href="Joint_Torque_Springs_Example.html">Joint Torque Springs Example</a></li>                                    <li id="n-Joint-Trajectory-Playback-Example"><a href="Joint_Trajectory_Playback_Example.html">Joint Trajectory Playback Example</a></li>                                    <li id="n-Set-Interaction-Options-Example"><a href="Set_Interaction_Options_Example.html">Set Interaction Options Example</a></li>                                    <li id="n-Motion-Interface-Go-To-Joint-Angles"><a href="Go_To_Joint_Angles_Example.html">Motion Interface Go-To-Joint Angles</a></li>                            </ul>
                </li>
          <li>
          <span>Support</span>

                    <ul class="collapsible-collapsed">
                                    <li id="n-User-Forum"><a href="User_Forum.html">User Forum</a></li>                            </ul>
                </li>
          <li>
          <span>Tools</span>

                    <ul class="collapsible-collapsed">
                                    <li id="n-All-Pages"><a href="Special_AllPages.html">All Pages</a></li>                                    <li id="n-Print"><a href="a/indexd440.html?title=Joint_Trajectory_Playback_Example&amp;printable=yes" rel="nofollow">Print</a></li>                                    <li id="n-Upload-File"><a href="Special_Upload.html">Upload File</a></li>                                    <li id="n-What-Links-Here.3F"><a href="Special_WhatLinksHere.html">What Links Here?</a></li>                            </ul>
                </li>
            </ul> <!-- /nav -->
    </div> <!-- /side -->
<!-- end fragment sidebar -->
    <div id="mainContent"> <!-- cavendishmw: s/column-content/mainContent/ -->
        
        <div id="bodyContent" class="mw-body">

            <div id="contentSub">
                            </div>

            
            
                            <div id="jump-to-nav" class="mw-jump">
                    Jump to:                    <a href="#column-one">navigation</a>
                    ,                     <a href="#searchInput">search</a>
                </div>
            
            <!-- start content -->
            <div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div class="mw-parser-output"><div class="title-block">
<p><span style="font-size:120%;"><b>Enable the robot joint trajectory interface, parse a file created using the joint position recorder example, and send the resulting joint trajectory to the action server.</b></span>
</p>
</div>
<div class="toclimit-2"><div id="toc" class="toc"><div class="toctitle" lang="en" dir="ltr"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Overview"><span class="tocnumber">1</span> <span class="toctext">Overview</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Introduction"><span class="tocnumber">2</span> <span class="toctext">Introduction</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Usage"><span class="tocnumber">3</span> <span class="toctext">Usage</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Arguments"><span class="tocnumber">4</span> <span class="toctext">Arguments</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Interfaces"><span class="tocnumber">5</span> <span class="toctext">Interfaces</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="#Code_Walkthrough"><span class="tocnumber">6</span> <span class="toctext">Code Walkthrough</span></a></li>
</ul>
</div>
</div>
<div class="content-block">
<h2><span class="mw-headline" id="Overview">Overview</span></h2>
<p>A commonly used ROS method for robot arm motion control is the joint trajectory action interface. The trajectory_controller and it's corresponding joint trajectory action server is the intera_interface implementation to support this action interface. This example shows usage for launching the joint trajectory action server, and parsing of a text file describing timestamped joint position goals into a joint trajectory action call to be commanded to the joint trajectory action server.
</p>
</div>
<div class="content-block">
<h2><span class="mw-headline" id="Introduction">Introduction</span></h2>
<p>This example demonstrates the usage of the <code>Joint Trajectory Action server</code> to command raw joint position commands. The <code>main()</code> creates and instance of the Trajectory class and calls the <code>parse_file()</code> method. This method is responsible for parsing the input file and packing them as Request message for the <code>Joint Trajectory Action server</code>. The <code>start()</code> method is then called, which sends the Request messages to the action server. Finally, wait() is then called, which verifies if the trajectory execution was successful. Action Servers - <code>robot/limb/right/follow_joint_trajectory</code>.
If you would like to follow along with the actual source code for the example on GitHub, it can be found through <a rel="nofollow" class="external text" href="https://github.com/RethinkRobotics/intera_sdk/blob/master/intera_examples/scripts/joint_trajectory_file_playback.py">this link</a> for joint trajectory file playback example.
<br />
</p>
</div>
<div class="content-block">
<h2><span class="mw-headline" id="Usage">Usage</span></h2>
<p>Verify that the robot is enabled from an <a href="SDK_Shell.html" title="SDK Shell">SDK terminal session</a>, if the robot is not enabled run:
</p>
<div class="mw-highlight mw-content-ltr" dir="ltr"><pre><span></span>$ rosrun intera_interface robot_enable.py
</pre></div>
<p>Record a joint position file using the recorder.py example, ex:
</p>
<div class="mw-highlight mw-content-ltr" dir="ltr"><pre><span></span>$ rosrun intera_examples recorder.py -f &lt;position_file_name&gt;
</pre></div>
<p>The recorder is now recording joint positions with corresponding timestamps for robot arm. Move the arms while holding the cuffs. If the position file name exists, the function will overwrite existing file.
</p><p>NOTE: You can open and close the gripper while recording by using the robot's cuff buttons: Oval(lower) = Close, Circle(Upper) = Open
</p><p>Start the joint trajectory controller, ex:
</p>
<div class="mw-highlight mw-content-ltr" dir="ltr"><pre><span></span>$ rosrun intera_interface joint_trajectory_action_server.py --mode velocity
</pre></div>
<p>In another RSDK terminal session, Run the joint trajectory playback example program, ex:
</p>
<div class="mw-highlight mw-content-ltr" dir="ltr"><pre><span></span>$ rosrun intera_examples joint_trajectory_file_playback.py -f &lt;position_file_name&gt;
</pre></div>
<p>The robot arm will then be commanded to repeat the trajectory recorded during the joint position recording. The difference between this example and the joint_position playback example is that the trajectory controller has the ability to honor the velocities (due to the timestamps) to more accurately repeating the recorded trajectory.
</p>
</div>
<div class="content-block">
<h2><span class="mw-headline" id="Arguments">Arguments</span></h2>
<p><b>Important Arguments:</b> 
Arguments for joint_trajectory_action_server.py
</p><p>See the trajectory controller's usage on the command line by passing trajectory_controller.py the -h, help argument:
</p>
<div class="mw-highlight mw-content-ltr" dir="ltr"><pre><span></span>$ rosrun intera_interface joint_trajectory_action_server.py -h
</pre></div>
<div class="mw-highlight mw-content-ltr" dir="ltr"><pre><span></span>Intera SDK Joint Trajectory Controller

    Unlike other robots running ROS, this is not a Motor Controller plugin,
    but a regular node using the SDK interface.    

optional arguments:
  -h, --help            show this <span class="nb">help</span> message and <span class="nb">exit</span>
  -l <span class="o">{</span>right<span class="o">}</span>, --limb <span class="o">{</span>right<span class="o">}</span>
                        joint trajectory action server limb <span class="o">(</span>default: right<span class="o">)</span>
  -r RATE, --rate RATE  trajectory control rate <span class="o">(</span>Hz<span class="o">)</span> <span class="o">(</span>default: <span class="m">100</span>.0<span class="o">)</span>
  -m <span class="o">{</span>position_w_id,position,velocity<span class="o">}</span>, --mode <span class="o">{</span>position_w_id,position,velocity<span class="o">}</span>
                        control mode <span class="k">for</span> trajectory execution <span class="o">(</span>default:
                        position_w_id<span class="o">)</span>
</pre></div>
<p><b>Important Arguments:</b> 
Arguments for joint_trajectory_file_playback.py
</p><p>See the joint_trajectory_file_playback's usage on the command line by passing joint_trajectory_file_playback.py the -h, help argument:
</p>
<div class="mw-highlight mw-content-ltr" dir="ltr"><pre><span></span>$ rosrun intera_interface joint_trajectory_file_playback.py -h
</pre></div>
<div class="mw-highlight mw-content-ltr" dir="ltr"><pre><span></span>RSDK Joint Trajectory Example: File Playback

    Plays back joint positions honoring timestamps recorded
    via the joint_recorder example.

    Run the joint_recorder.py example first to create a recording
    file <span class="k">for</span> use with this example. Then make sure to start the
    joint_trajectory_action_server before running this example.

    This example will use the joint trajectory action server
    with velocity control to follow the positions and <span class="nb">times</span> of
    the recorded motion, accurately replicating movement speed
    necessary to hit each trajectory point on time.

required arguments:
  -f FILE, --file FILE   path to input file
optional arguments:
  -h, --help            show this <span class="nb">help</span> message and <span class="nb">exit</span>
  -l LOOPS, --loops LOOPS
                         number of playback loops. <span class="nv">0</span><span class="o">=</span>infinite. <span class="o">(</span>default: <span class="m">1</span><span class="o">)</span>
</pre></div>
</div>
<div class="content-block">
<h2><span class="mw-headline" id="Interfaces">Interfaces</span></h2>
<p><b>ROS APIs:</b> 
</p><p>See the API Reference page for details: <a href="API_Reference.html" title="API Reference">ROS APIs</a>
</p>
<div class="mw-highlight mw-content-ltr" dir="ltr"><pre><span></span>Joint Trajectory Action Server - /robot/limb/right/follow_joint_trajectory <span class="o">[</span>control_msgs/FollowJointTrajectoryAction<span class="o">]</span>
</pre></div>
<p><b>Intera_interface APIs:</b> 
</p>
<div class="mw-highlight mw-content-ltr" dir="ltr"><pre><span></span>JointTrajectoryActionServer class: joint_trajectory_action_server.py
</pre></div>
</div>
<div class="content-block">
<h2><span class="mw-headline" id="Code_Walkthrough">Code Walkthrough</span></h2>
<p>Now, let's break down the code.
</p>
<div class="mw-highlight mw-content-ltr" dir="ltr"><pre><span></span><span class="lineno">33 </span><span class="kn">import</span> <span class="nn">argparse</span>
<span class="lineno">34 </span><span class="kn">import</span> <span class="nn">operator</span>
<span class="lineno">35 </span><span class="kn">import</span> <span class="nn">sys</span>
<span class="lineno">36 </span><span class="kn">import</span> <span class="nn">threading</span>
<span class="lineno">37 </span>
<span class="lineno">38 </span><span class="kn">from</span> <span class="nn">bisect</span> <span class="kn">import</span> <span class="n">bisect</span>
<span class="lineno">39 </span><span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">copy</span>
<span class="lineno">40 </span><span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">path</span>
<span class="lineno">41 </span>
<span class="lineno">42 </span><span class="kn">import</span> <span class="nn">rospy</span>
<span class="lineno">43 </span>
<span class="lineno">44 </span><span class="kn">import</span> <span class="nn">actionlib</span>
<span class="lineno">45 </span>
<span class="lineno">46 </span><span class="kn">from</span> <span class="nn">control_msgs.msg</span> <span class="kn">import</span> <span class="p">(</span>
<span class="lineno">47 </span>    <span class="n">FollowJointTrajectoryAction</span><span class="p">,</span>
<span class="lineno">48 </span>    <span class="n">FollowJointTrajectoryGoal</span><span class="p">,</span>
<span class="lineno">49 </span><span class="p">)</span>
<span class="lineno">50 </span><span class="kn">from</span> <span class="nn">trajectory_msgs.msg</span> <span class="kn">import</span> <span class="p">(</span>
<span class="lineno">51 </span>    <span class="n">JointTrajectoryPoint</span><span class="p">,</span>
<span class="lineno">52 </span><span class="p">)</span>
<span class="lineno">53 </span>
<span class="lineno">54 </span><span class="kn">import</span> <span class="nn">intera_interface</span>
<span class="lineno">55 </span>
<span class="lineno">56 </span><span class="kn">from</span> <span class="nn">intera_interface</span> <span class="kn">import</span> <span class="n">CHECK_VERSION</span>
</pre></div>
<p>This imports the intera_interface for accessing the limb and the gripper class. The <code>actionlib</code> is imported to use its <code>Action Server</code> class.The <code>CHECK_VERSION</code> is imported to check if the software running on the robot would be compatible with this local version. It is not necessary to check the version in custom programs.
</p>
<div class="mw-highlight mw-content-ltr" dir="ltr"><pre><span></span><span class="lineno">59 </span><span class="k">class</span> <span class="nc">Trajectory</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="lineno">60 </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limb</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">):</span>
<span class="lineno">61 </span>        <span class="c1">#create our action server clients</span>
<span class="lineno">62 </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_limb_client</span> <span class="o">=</span> <span class="n">actionlib</span><span class="o">.</span><span class="n">SimpleActionClient</span><span class="p">(</span>
<span class="lineno">63 </span>            <span class="s1">&#39;robot/limb/right/follow_joint_trajectory&#39;</span><span class="p">,</span>
<span class="lineno">64 </span>            <span class="n">FollowJointTrajectoryAction</span><span class="p">,</span>
<span class="lineno">65 </span>        <span class="p">)</span>
<span class="lineno">66 </span>
<span class="lineno">67 </span>        <span class="c1">#verify joint trajectory action servers are available</span>
<span class="lineno">68 </span>        <span class="n">is_server_up</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_limb_client</span><span class="o">.</span><span class="n">wait_for_server</span><span class="p">(</span><span class="n">rospy</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="mf">10.0</span><span class="p">))</span>
<span class="lineno">69 </span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_server_up</span><span class="p">:</span>
<span class="lineno">70 </span>            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Action server not available.&quot;</span>
<span class="lineno">71 </span>                   <span class="s2">&quot; Verify action server availability.&quot;</span><span class="p">)</span>
<span class="lineno">72 </span>            <span class="n">rospy</span><span class="o">.</span><span class="n">logerr</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<span class="lineno">73 </span>            <span class="n">rospy</span><span class="o">.</span><span class="n">signal_shutdown</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<span class="lineno">74 </span>            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
<p>Action server clients for the right limb is created. The existence of action server for right limb is checked with a timeout of 10 seconds. If it is not available, a shutdown signal is sent and the program exits.
</p>
<div class="mw-highlight mw-content-ltr" dir="ltr"><pre><span></span><span class="lineno">76 </span>        <span class="c1">#create our goal request</span>
<span class="lineno">77 </span>        <span class="bp">self</span><span class="o">.</span><span class="n">goal</span> <span class="o">=</span> <span class="n">FollowJointTrajectoryGoal</span><span class="p">()</span>
<span class="lineno">78 </span>
<span class="lineno">79 </span>        <span class="c1">#limb interface - current angles needed for start move</span>
<span class="lineno">80 </span>        <span class="bp">self</span><span class="o">.</span><span class="n">arm</span> <span class="o">=</span> <span class="n">intera_interface</span><span class="o">.</span><span class="n">Limb</span><span class="p">(</span><span class="n">limb</span><span class="p">)</span>
<span class="lineno">81 </span>
<span class="lineno">82 </span>        <span class="bp">self</span><span class="o">.</span><span class="n">limb</span> <span class="o">=</span> <span class="n">limb</span>
<span class="lineno">83 </span>        <span class="bp">self</span><span class="o">.</span><span class="n">gripper_name</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">limb</span><span class="p">,</span> <span class="s1">&#39;gripper&#39;</span><span class="p">])</span>
<span class="lineno">84 </span>        <span class="c1">#gripper interface - for gripper command playback</span>
<span class="lineno">85 </span>        <span class="k">try</span><span class="p">:</span>
<span class="lineno">86 </span>            <span class="bp">self</span><span class="o">.</span><span class="n">gripper</span> <span class="o">=</span> <span class="n">intera_interface</span><span class="o">.</span><span class="n">Gripper</span><span class="p">(</span><span class="n">limb</span><span class="p">)</span>
<span class="lineno">87 </span>            <span class="bp">self</span><span class="o">.</span><span class="n">has_gripper</span> <span class="o">=</span> <span class="bp">True</span>
<span class="lineno">88 </span>        <span class="k">except</span><span class="p">:</span>
<span class="lineno">89 </span>            <span class="bp">self</span><span class="o">.</span><span class="n">has_gripper</span> <span class="o">=</span> <span class="bp">False</span>
<span class="lineno">90 </span>            <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s2">&quot;Did not detect a connected electric gripper.&quot;</span><span class="p">)</span>
<span class="lineno">91 </span>            
<span class="lineno">92 </span>        <span class="c1">#flag to signify the arm trajectories have begun executing</span>
<span class="lineno">93 </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_arm_trajectory_started</span> <span class="o">=</span> <span class="bp">False</span>
<span class="lineno">94 </span>        <span class="c1">#reentrant lock to prevent same-thread lockout</span>
<span class="lineno">95 </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">RLock</span><span class="p">()</span>
</pre></div>
<p>The request message that will hold the goal position for right limbs' action server is created. The current joint is also captured. If there is a electric gripper connected, the gripper positions will be captured as well.
</p>
<div class="mw-highlight mw-content-ltr" dir="ltr"><pre><span></span><span class="lineno"> 97 </span>        <span class="c1"># Verify Grippers Have No Errors and are Calibrated</span>
<span class="lineno"> 98 </span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_gripper</span><span class="p">:</span>
<span class="lineno"> 99 </span>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gripper</span><span class="o">.</span><span class="n">has_error</span><span class="p">():</span>
<span class="lineno">100 </span>                <span class="bp">self</span><span class="o">.</span><span class="n">gripper</span><span class="o">.</span><span class="n">reboot</span><span class="p">()</span>
<span class="lineno">101 </span>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">gripper</span><span class="o">.</span><span class="n">is_calibrated</span><span class="p">():</span>
<span class="lineno">102 </span>                <span class="bp">self</span><span class="o">.</span><span class="n">gripper</span><span class="o">.</span><span class="n">calibrate</span><span class="p">()</span>
<span class="lineno">103 </span>
<span class="lineno">104 </span>            <span class="c1">#gripper goal trajectories</span>
<span class="lineno">105 </span>            <span class="bp">self</span><span class="o">.</span><span class="n">grip</span> <span class="o">=</span> <span class="n">FollowJointTrajectoryGoal</span><span class="p">()</span>
<span class="lineno">106 </span>
<span class="lineno">107 </span>            <span class="c1">#gripper control rate</span>
<span class="lineno">108 </span>            <span class="bp">self</span><span class="o">.</span><span class="n">_gripper_rate</span> <span class="o">=</span> <span class="mf">20.0</span>  <span class="c1"># Hz</span>
<span class="lineno">109 </span>
<span class="lineno">110 </span>        <span class="c1"># Timing offset to prevent gripper playback before trajectory has started</span>
<span class="lineno">111 </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_slow_move_offset</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="lineno">112 </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_trajectory_start_offset</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
<span class="lineno">113 </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_trajectory_actual_offset</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
<span class="lineno">114 </span>
<span class="lineno">115 </span>        <span class="c1">#param namespace</span>
<span class="lineno">116 </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_param_ns</span> <span class="o">=</span> <span class="s1">&#39;/rsdk_joint_trajectory_action_server/&#39;</span>
</pre></div>
<p>The <code>error()</code> method returns whether or not the gripper is in an error state. The possible cause of errors might be over/under-voltage, over/under-current, motor faults, etc. The <code>calibrated()</code> method returns a boolean, true if the gripper is already calibrated. The request message that will hold the goal position for the gripper is created. The namespace is modified and the gripper's control rates is modified.
</p>
<div class="mw-highlight mw-content-ltr" dir="ltr"><pre><span></span><span class="lineno">118 </span>    <span class="k">def</span> <span class="nf">_execute_gripper_commands</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="lineno">119 </span>        <span class="n">start_time</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trajectory_actual_offset</span><span class="o">.</span><span class="n">to_sec</span><span class="p">()</span>
<span class="lineno">120 </span>        <span class="n">grip_cmd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grip</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">points</span>
<span class="lineno">121 </span>        <span class="n">pnt_times</span> <span class="o">=</span> <span class="p">[</span><span class="n">pnt</span><span class="o">.</span><span class="n">time_from_start</span><span class="o">.</span><span class="n">to_sec</span><span class="p">()</span> <span class="k">for</span> <span class="n">pnt</span> <span class="ow">in</span> <span class="n">grip_cmd</span><span class="p">]</span>
<span class="lineno">122 </span>        <span class="n">end_time</span> <span class="o">=</span> <span class="n">pnt_times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="lineno">123 </span>        <span class="n">rate</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Rate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_gripper_rate</span><span class="p">)</span>
<span class="lineno">124 </span>        <span class="n">now_from_start</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
<span class="lineno">125 </span>        <span class="k">while</span><span class="p">(</span><span class="n">now_from_start</span> <span class="o">&lt;</span> <span class="n">end_time</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gripper_rate</span><span class="p">)</span> <span class="ow">and</span>
<span class="lineno">126 </span>              <span class="ow">not</span> <span class="n">rospy</span><span class="o">.</span><span class="n">is_shutdown</span><span class="p">()):</span>
<span class="lineno">127 </span>            <span class="n">idx</span> <span class="o">=</span> <span class="n">bisect</span><span class="p">(</span><span class="n">pnt_times</span><span class="p">,</span> <span class="n">now_from_start</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
<span class="lineno">128 </span>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_gripper</span><span class="p">:</span>
<span class="lineno">129 </span>                <span class="bp">self</span><span class="o">.</span><span class="n">gripper</span><span class="o">.</span><span class="n">set_position</span><span class="p">(</span><span class="n">grip_cmd</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">positions</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="lineno">130 </span>            <span class="n">rate</span><span class="o">.</span><span class="n">sleep</span><span class="p">()</span>
<span class="lineno">131 </span>            <span class="n">now_from_start</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
</pre></div>
<p>The grip_cmd variable holds the gripper' position that was parsed from the file. The corresponding time stamps are read into pnt_times variable. idx holds the index of the timestamp from the file, relative to the current one. It is important to note that the velocity at which the Joint Positions was traversed is preserved during the playback. The corresponding gripper's position is then commanded to the action server.
</p>
<div class="mw-highlight mw-content-ltr" dir="ltr"><pre><span></span><span class="lineno">133 </span>    <span class="k">def</span> <span class="nf">_clean_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">joint_names</span><span class="p">):</span>
<span class="lineno">134 </span>        <span class="sd">&quot;&quot;&quot;</span>
<span class="lineno">135 </span><span class="sd">        Cleans a single line of recorded joint positions</span>
<span class="lineno">136 </span>
<span class="lineno">137 </span><span class="sd">        @param line: the line described in a list to process</span>
<span class="lineno">138 </span><span class="sd">        @param joint_names: joint name keys</span>
<span class="lineno">139 </span>
<span class="lineno">140 </span><span class="sd">        @return command: returns dictionary {joint: value} of valid commands</span>
<span class="lineno">141 </span><span class="sd">        @return line: returns list of current line values stripped of commas</span>
<span class="lineno">142 </span><span class="sd">        &quot;&quot;&quot;</span>
<span class="lineno">143 </span>        <span class="k">def</span> <span class="nf">try_float</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="lineno">144 </span>            <span class="k">try</span><span class="p">:</span>
<span class="lineno">145 </span>                <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="lineno">146 </span>            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
<span class="lineno">147 </span>                <span class="k">return</span> <span class="bp">None</span>
<span class="lineno">148 </span>        <span class="c1">#convert the line of strings to a float or None</span>
<span class="lineno">149 </span>        <span class="n">line</span> <span class="o">=</span> <span class="p">[</span><span class="n">try_float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)]</span>
<span class="lineno">150 </span>        <span class="c1">#zip the values with the joint names</span>
<span class="lineno">151 </span>        <span class="n">combined</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">joint_names</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
<span class="lineno">152 </span>        <span class="c1">#take out any tuples that have a none value</span>
<span class="lineno">153 </span>        <span class="n">cleaned</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">combined</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">]</span>
<span class="lineno">154 </span>        <span class="c1">#convert it to a dictionary with only valid commands</span>
<span class="lineno">155 </span>        <span class="n">command</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">cleaned</span><span class="p">)</span>
<span class="lineno">156 </span>        <span class="k">return</span> <span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">line</span><span class="p">,)</span>
</pre></div>
<p>This <code>try_float()</code> function replaces the contents of the variable passed with float and none values. Then, a tuple is constructed by zipping the names passed with the values from the variable line. This may contain valid values as well as none values . After removing the none values, a dictionary is constructed. This dictionary is then parsed to create valid Joint commands.
</p>
<div class="mw-highlight mw-content-ltr" dir="ltr"><pre><span></span><span class="lineno">158 </span>    <span class="k">def</span> <span class="nf">_add_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">positions</span><span class="p">,</span> <span class="n">side</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
<span class="lineno">159 </span>        <span class="sd">&quot;&quot;&quot;</span>
<span class="lineno">160 </span><span class="sd">        Appends trajectory with new point</span>
<span class="lineno">161 </span>
<span class="lineno">162 </span><span class="sd">        @param positions: joint positions</span>
<span class="lineno">163 </span><span class="sd">        @param side: limb to command point</span>
<span class="lineno">164 </span><span class="sd">        @param time: time from start for point in seconds</span>
<span class="lineno">165 </span><span class="sd">        &quot;&quot;&quot;</span>
<span class="lineno">166 </span>        <span class="c1">#creates a point in trajectory with time_from_start and positions</span>
<span class="lineno">167 </span>        <span class="n">point</span> <span class="o">=</span> <span class="n">JointTrajectoryPoint</span><span class="p">()</span>
<span class="lineno">168 </span>        <span class="n">point</span><span class="o">.</span><span class="n">positions</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span>
<span class="lineno">169 </span>        <span class="n">point</span><span class="o">.</span><span class="n">time_from_start</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
<span class="lineno">170 </span>        <span class="k">if</span> <span class="n">side</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">limb</span><span class="p">:</span>
<span class="lineno">171 </span>            <span class="bp">self</span><span class="o">.</span><span class="n">goal</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
<span class="lineno">172 </span>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_gripper</span> <span class="ow">and</span> <span class="n">side</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">gripper_name</span><span class="p">:</span>
<span class="lineno">173 </span>            <span class="bp">self</span><span class="o">.</span><span class="n">grip</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
</pre></div>
<p>This method creates a request message of the <code>JointTrajectoryPoint</code> type and appends the goal position based on the side of the limb/gripper that is requesting. It compiles a list of Joint Positions as the trajectory.
</p>
<div class="mw-highlight mw-content-ltr" dir="ltr"><pre><span></span><span class="lineno">175 </span>    <span class="k">def</span> <span class="nf">parse_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="lineno">176 </span>        <span class="sd">&quot;&quot;&quot;</span>
<span class="lineno">177 </span><span class="sd">        Parses input file into FollowJointTrajectoryGoal format</span>
<span class="lineno">178 </span>
<span class="lineno">179 </span><span class="sd">        @param filename: input filename</span>
<span class="lineno">180 </span><span class="sd">        &quot;&quot;&quot;</span>
<span class="lineno">181 </span>        <span class="c1">#open recorded file</span>
<span class="lineno">182 </span>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="lineno">183 </span>            <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
<span class="lineno">184 </span>        <span class="c1">#read joint names specified in file</span>
<span class="lineno">185 </span>        <span class="n">joint_names</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
<span class="lineno">186 </span>        <span class="c1">#parse joint names for right limb</span>
<span class="lineno">187 </span>        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">joint_names</span><span class="p">:</span>
<span class="lineno">188 </span>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">limb</span> <span class="o">==</span> <span class="n">name</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]:</span>
<span class="lineno">189 </span>                <span class="bp">self</span><span class="o">.</span><span class="n">goal</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">joint_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</pre></div>
<p>The lines are split into a list with ',' as the delimiter to extract the joint names. The arm of the current joint, found by stripping the "_&lt;joint&gt;" (last three characters) from the joint_name, is checked and stored.
</p>
<div class="mw-highlight mw-content-ltr" dir="ltr"><pre><span></span><span class="lineno">191 </span>        <span class="k">def</span> <span class="nf">find_start_offset</span><span class="p">(</span><span class="n">pos</span><span class="p">):</span>
<span class="lineno">192 </span>            <span class="c1">#create empty lists</span>
<span class="lineno">193 </span>            <span class="n">cur</span> <span class="o">=</span> <span class="p">[]</span>
<span class="lineno">194 </span>            <span class="n">cmd</span> <span class="o">=</span> <span class="p">[]</span>
<span class="lineno">195 </span>            <span class="n">dflt_vel</span> <span class="o">=</span> <span class="p">[]</span>
<span class="lineno">196 </span>            <span class="n">vel_param</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_param_ns</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_default_velocity&quot;</span>
<span class="lineno">197 </span>            <span class="c1">#for all joints find our current and first commanded position</span>
<span class="lineno">198 </span>            <span class="c1">#reading default velocities from the parameter server if specified</span>
<span class="lineno">199 </span>            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">joint_names</span><span class="p">:</span>
<span class="lineno">200 </span>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">limb</span> <span class="o">==</span> <span class="n">name</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]:</span>
<span class="lineno">201 </span>                    <span class="n">cmd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
<span class="lineno">202 </span>                    <span class="n">cur</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arm</span><span class="o">.</span><span class="n">joint_angle</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
<span class="lineno">203 </span>                    <span class="n">prm</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="n">vel_param</span> <span class="o">%</span> <span class="n">name</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">)</span>
<span class="lineno">204 </span>                    <span class="n">dflt_vel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prm</span><span class="p">)</span>
<span class="lineno">205 </span>            <span class="n">diffs</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">sub</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">cur</span><span class="p">)</span>
<span class="lineno">206 </span>            <span class="n">diffs</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">abs</span><span class="p">,</span> <span class="n">diffs</span><span class="p">)</span>
<span class="lineno">207 </span>            <span class="c1">#determine the largest time offset necessary across all joints</span>
<span class="lineno">208 </span>            <span class="n">offset</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">div</span><span class="p">,</span> <span class="n">diffs</span><span class="p">,</span> <span class="n">dflt_vel</span><span class="p">))</span>
<span class="lineno">209 </span>            <span class="k">return</span> <span class="n">offset</span>
</pre></div>
<p>The first commanded position and the current position for all the joints are captured. The default values that were loaded into the param server are read. The largest time offset necessary across all the joints is calculated.
</p>
<div class="mw-highlight mw-content-ltr" dir="ltr"><pre><span></span><span class="lineno">211 </span>        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
<span class="lineno">212 </span>            <span class="c1">#clean each line of file</span>
<span class="lineno">213 </span>            <span class="n">cmd</span><span class="p">,</span> <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clean_line</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">joint_names</span><span class="p">)</span>
<span class="lineno">214 </span>            <span class="c1">#find allowable time offset for move to start position</span>
<span class="lineno">215 </span>            <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<span class="lineno">216 </span>                <span class="c1"># Set the initial position to be the current pose.</span>
<span class="lineno">217 </span>                <span class="c1"># This ensures we move slowly to the starting point of the</span>
<span class="lineno">218 </span>                <span class="c1"># trajectory from the current pose - The user may have moved</span>
<span class="lineno">219 </span>                <span class="c1"># arm since recording</span>
<span class="lineno">220 </span>                <span class="n">cur_cmd</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">arm</span><span class="o">.</span><span class="n">joint_angle</span><span class="p">(</span><span class="n">jnt</span><span class="p">)</span> <span class="k">for</span> <span class="n">jnt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">goal</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">joint_names</span><span class="p">]</span>
<span class="lineno">221 </span>                <span class="bp">self</span><span class="o">.</span><span class="n">_add_point</span><span class="p">(</span><span class="n">cur_cmd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">limb</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<span class="lineno">222 </span>                <span class="n">start_offset</span> <span class="o">=</span> <span class="n">find_start_offset</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
<span class="lineno">223 </span>                <span class="c1"># Gripper playback won&#39;t start until the starting movement&#39;s</span>
<span class="lineno">224 </span>                <span class="c1"># duration has passed, and the actual trajectory playback begins</span>
<span class="lineno">225 </span>                <span class="bp">self</span><span class="o">.</span><span class="n">_slow_move_offset</span> <span class="o">=</span> <span class="n">start_offset</span>
<span class="lineno">226 </span>                <span class="bp">self</span><span class="o">.</span><span class="n">_trajectory_start_offset</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="n">start_offset</span> <span class="o">+</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="lineno">227 </span>            <span class="c1">#add a point for this set of commands with recorded time</span>
<span class="lineno">228 </span>            <span class="n">cur_cmd</span> <span class="o">=</span> <span class="p">[</span><span class="n">cmd</span><span class="p">[</span><span class="n">jnt</span><span class="p">]</span> <span class="k">for</span> <span class="n">jnt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">goal</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">joint_names</span><span class="p">]</span>
<span class="lineno">229 </span>            <span class="bp">self</span><span class="o">.</span><span class="n">_add_point</span><span class="p">(</span><span class="n">cur_cmd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">limb</span><span class="p">,</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">start_offset</span><span class="p">)</span>
<span class="lineno">230 </span>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_gripper</span><span class="p">:</span>
<span class="lineno">231 </span>                <span class="n">cur_cmd</span> <span class="o">=</span> <span class="p">[</span><span class="n">cmd</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">gripper_name</span><span class="p">]]</span>
<span class="lineno">232 </span>                <span class="bp">self</span><span class="o">.</span><span class="n">_add_point</span><span class="p">(</span><span class="n">cur_cmd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gripper_name</span><span class="p">,</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">start_offset</span><span class="p">)</span>
</pre></div>
<p>The non-float values are cleaned and a dictionary of valid Joint Commands is returned in the _clean_line() function as explained above. The time offset for move to start position is also calculated. The parsed set of recorded commands along with their recorded time is added to the goal list as well as gripper's command and time.
</p>
<div class="mw-highlight mw-content-ltr" dir="ltr"><pre><span></span><span class="lineno">234 </span>    <span class="k">def</span> <span class="nf">_feedback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="lineno">235 </span>        <span class="c1"># Test to see if the actual playback time has exceeded</span>
<span class="lineno">236 </span>        <span class="c1"># the move-to-start-pose timing offset</span>
<span class="lineno">237 </span>        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_trajectory_flag</span><span class="p">()</span> <span class="ow">and</span>
<span class="lineno">238 </span>              <span class="n">data</span><span class="o">.</span><span class="n">actual</span><span class="o">.</span><span class="n">time_from_start</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trajectory_start_offset</span><span class="p">):</span>
<span class="lineno">239 </span>            <span class="bp">self</span><span class="o">.</span><span class="n">_set_trajectory_flag</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="lineno">240 </span>            <span class="bp">self</span><span class="o">.</span><span class="n">_trajectory_actual_offset</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">actual</span><span class="o">.</span><span class="n">time_from_start</span>
</pre></div>
<p>Called in start function, test to see if the actual playback time has exceeded the move-to-start-pose timing offset.
</p>
<div class="mw-highlight mw-content-ltr" dir="ltr"><pre><span></span><span class="lineno">242 </span>    <span class="k">def</span> <span class="nf">_set_trajectory_flag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
<span class="lineno">243 </span>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
<span class="lineno">244 </span>            <span class="c1"># Assign a value to the flag</span>
<span class="lineno">245 </span>            <span class="bp">self</span><span class="o">.</span><span class="n">_arm_trajectory_started</span> <span class="o">=</span> <span class="n">value</span>
<span class="lineno">246 </span>
<span class="lineno">247 </span>    <span class="k">def</span> <span class="nf">_get_trajectory_flag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="lineno">248 </span>        <span class="n">temp_flag</span> <span class="o">=</span> <span class="bp">False</span>
<span class="lineno">249 </span>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
<span class="lineno">250 </span>            <span class="c1"># Copy to external variable</span>
<span class="lineno">251 </span>            <span class="n">temp_flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arm_trajectory_started</span>
<span class="lineno">252 </span>        <span class="k">return</span> <span class="n">temp_flag</span>
</pre></div>
<p>Assign the value to the trajectory flag function and get the trajectory flag value function.
</p>
<div class="mw-highlight mw-content-ltr" dir="ltr"><pre><span></span><span class="lineno">254 </span>    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="lineno">255 </span>        <span class="sd">&quot;&quot;&quot;</span>
<span class="lineno">256 </span><span class="sd">        Sends FollowJointTrajectoryAction request</span>
<span class="lineno">257 </span><span class="sd">        &quot;&quot;&quot;</span>
<span class="lineno">258 </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_limb_client</span><span class="o">.</span><span class="n">send_goal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">goal</span><span class="p">,</span> <span class="n">feedback_cb</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_feedback</span><span class="p">)</span>
<span class="lineno">259 </span>        <span class="c1"># Syncronize playback by waiting for the trajectories to start</span>
<span class="lineno">260 </span>        <span class="k">while</span> <span class="ow">not</span> <span class="n">rospy</span><span class="o">.</span><span class="n">is_shutdown</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_trajectory_flag</span><span class="p">():</span>
<span class="lineno">261 </span>            <span class="n">rospy</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span>
<span class="lineno">262 </span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_gripper</span><span class="p">:</span>
<span class="lineno">263 </span>            <span class="bp">self</span><span class="o">.</span><span class="n">_execute_gripper_commands</span><span class="p">()</span>
</pre></div>
<p>This function sends the FollowJointTrajectoryAction request message which includes the recorded positions and their corresponding time, to the Joint Trajectory Action Server.
</p>
<div class="mw-highlight mw-content-ltr" dir="ltr"><pre><span></span><span class="lineno">265 </span>    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="lineno">266 </span>        <span class="sd">&quot;&quot;&quot;</span>
<span class="lineno">267 </span><span class="sd">        Preempts trajectory execution by sending cancel goals</span>
<span class="lineno">268 </span><span class="sd">        &quot;&quot;&quot;</span>
<span class="lineno">269 </span>        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_limb_client</span><span class="o">.</span><span class="n">gh</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span>
<span class="lineno">270 </span>            <span class="bp">self</span><span class="o">.</span><span class="n">_limb_client</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span> <span class="o">==</span> <span class="n">actionlib</span><span class="o">.</span><span class="n">GoalStatus</span><span class="o">.</span><span class="n">ACTIVE</span><span class="p">):</span>
<span class="lineno">271 </span>            <span class="bp">self</span><span class="o">.</span><span class="n">_limb_client</span><span class="o">.</span><span class="n">cancel_goal</span><span class="p">()</span>
<span class="lineno">272 </span>
<span class="lineno">273 </span>        <span class="c1">#delay to allow for terminating handshake</span>
<span class="lineno">274 </span>        <span class="n">rospy</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</pre></div>
<p>The Trajectory execution is stopped by sending cancel goals to the Joint trajectory action server.
</p>
<div class="mw-highlight mw-content-ltr" dir="ltr"><pre><span></span><span class="lineno">276 </span>    <span class="k">def</span> <span class="nf">wait</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="lineno">277 </span>        <span class="sd">&quot;&quot;&quot;</span>
<span class="lineno">278 </span><span class="sd">        Waits for and verifies trajectory execution result</span>
<span class="lineno">279 </span><span class="sd">        &quot;&quot;&quot;</span>
<span class="lineno">280 </span>        <span class="c1">#create a timeout for our trajectory execution</span>
<span class="lineno">281 </span>        <span class="c1">#total time trajectory expected for trajectory execution plus a buffer</span>
<span class="lineno">282 </span>        <span class="n">last_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">goal</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">time_from_start</span><span class="o">.</span><span class="n">to_sec</span><span class="p">()</span>
<span class="lineno">283 </span>        <span class="n">time_buffer</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_param_ns</span> <span class="o">+</span> <span class="s1">&#39;goal_time&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.5</span>
<span class="lineno">284 </span>        <span class="n">timeout</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_slow_move_offset</span> <span class="o">+</span>
<span class="lineno">285 </span>                                 <span class="n">last_time</span> <span class="o">+</span>
<span class="lineno">286 </span>                                 <span class="n">time_buffer</span><span class="p">)</span>
<span class="lineno">287 </span>
<span class="lineno">288 </span>        <span class="n">finish</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_limb_client</span><span class="o">.</span><span class="n">wait_for_result</span><span class="p">(</span><span class="n">timeout</span><span class="p">)</span>
<span class="lineno">289 </span>        <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_limb_client</span><span class="o">.</span><span class="n">get_result</span><span class="p">()</span><span class="o">.</span><span class="n">error_code</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<span class="lineno">290 </span>
<span class="lineno">291 </span>        <span class="c1">#verify result</span>
<span class="lineno">292 </span>        <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">finish</span><span class="p">,</span> <span class="n">result</span><span class="p">]):</span>
<span class="lineno">293 </span>            <span class="k">return</span> <span class="bp">True</span>
<span class="lineno">294 </span>        <span class="k">else</span><span class="p">:</span>
<span class="lineno">295 </span>            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Trajectory action failed or did not finish before &quot;</span>
<span class="lineno">296 </span>                   <span class="s2">&quot;timeout/interrupt.&quot;</span><span class="p">)</span>
<span class="lineno">297 </span>            <span class="n">rospy</span><span class="o">.</span><span class="n">logwarn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<span class="lineno">298 </span>            <span class="k">return</span> <span class="bp">False</span>
</pre></div>
<p>This method waits for the completion of the trajectory execution by Joint trajectory action server.
</p>
<div class="mw-highlight mw-content-ltr" dir="ltr"><pre><span></span><span class="lineno">301 </span><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="lineno">302 </span>    <span class="sd">&quot;&quot;&quot;RSDK Joint Trajectory Example: File Playback</span>
<span class="lineno">303 </span>
<span class="lineno">304 </span><span class="sd">    Plays back joint positions honoring timestamps recorded</span>
<span class="lineno">305 </span><span class="sd">    via the joint_recorder example.</span>
<span class="lineno">306 </span>
<span class="lineno">307 </span><span class="sd">    Run the joint_recorder.py example first to create a recording</span>
<span class="lineno">308 </span><span class="sd">    file for use with this example. Then make sure to start the</span>
<span class="lineno">309 </span><span class="sd">    joint_trajectory_action_server before running this example.</span>
<span class="lineno">310 </span>
<span class="lineno">311 </span><span class="sd">    This example will use the joint trajectory action server</span>
<span class="lineno">312 </span><span class="sd">    with velocity control to follow the positions and times of</span>
<span class="lineno">313 </span><span class="sd">    the recorded motion, accurately replicating movement speed</span>
<span class="lineno">314 </span><span class="sd">    necessary to hit each trajectory point on time.</span>
<span class="lineno">315 </span><span class="sd">    &quot;&quot;&quot;</span>
<span class="lineno">316 </span>    <span class="n">epilog</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="lineno">317 </span><span class="s2">Related examples:</span>
<span class="lineno">318 </span><span class="s2">  joint_recorder.py; joint_position_file_playback.py.</span>
<span class="lineno">319 </span><span class="s2">    &quot;&quot;&quot;</span>
<span class="lineno">320 </span>    <span class="n">arg_fmt</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">RawDescriptionHelpFormatter</span>
<span class="lineno">321 </span>    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">formatter_class</span><span class="o">=</span><span class="n">arg_fmt</span><span class="p">,</span>
<span class="lineno">322 </span>                                     <span class="n">description</span><span class="o">=</span><span class="n">main</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">,</span>
<span class="lineno">323 </span>                                     <span class="n">epilog</span><span class="o">=</span><span class="n">epilog</span><span class="p">)</span>
<span class="lineno">324 </span>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
<span class="lineno">325 </span>        <span class="s1">&#39;-f&#39;</span><span class="p">,</span> <span class="s1">&#39;--file&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;PATH&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
<span class="lineno">326 </span>        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;path to input file&#39;</span>
<span class="lineno">327 </span>    <span class="p">)</span>
<span class="lineno">328 </span>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
<span class="lineno">329 </span>        <span class="s1">&#39;-l&#39;</span><span class="p">,</span> <span class="s1">&#39;--loops&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="lineno">330 </span>        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;number of playback loops. 0=infinite.&#39;</span>
<span class="lineno">331 </span>    <span class="p">)</span>
<span class="lineno">332 </span>    <span class="c1"># remove ROS args and filename (sys.arv[0]) for argparse</span>
<span class="lineno">333 </span>    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">rospy</span><span class="o">.</span><span class="n">myargv</span><span class="p">()[</span><span class="mi">1</span><span class="p">:])</span>
</pre></div>
<p>The name source file to read the Joint Position is captured along with the number of times the trajectory has to be looped from the command line.
</p>
<div class="mw-highlight mw-content-ltr" dir="ltr"><pre><span></span><span class="lineno">335 </span>    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Initializing node... &quot;</span><span class="p">)</span>
<span class="lineno">336 </span>    <span class="n">rospy</span><span class="o">.</span><span class="n">init_node</span><span class="p">(</span><span class="s2">&quot;sdk_joint_trajectory_file_playback&quot;</span><span class="p">)</span>
<span class="lineno">337 </span>    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Getting robot state... &quot;</span><span class="p">)</span>
<span class="lineno">338 </span>    <span class="n">rs</span> <span class="o">=</span> <span class="n">intera_interface</span><span class="o">.</span><span class="n">RobotEnable</span><span class="p">(</span><span class="n">CHECK_VERSION</span><span class="p">)</span>
<span class="lineno">339 </span>    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Enabling robot... &quot;</span><span class="p">)</span>
<span class="lineno">340 </span>    <span class="n">rs</span><span class="o">.</span><span class="n">enable</span><span class="p">()</span>
<span class="lineno">341 </span>    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Running. Ctrl-c to quit&quot;</span><span class="p">)</span>
<span class="lineno">342 </span>
<span class="lineno">343 </span>    <span class="n">traj</span> <span class="o">=</span> <span class="n">Trajectory</span><span class="p">()</span>
<span class="lineno">344 </span>    <span class="n">traj</span><span class="o">.</span><span class="n">parse_file</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">file</span><span class="p">))</span>
<span class="lineno">345 </span>    <span class="c1">#for safe interrupt handling</span>
<span class="lineno">346 </span>    <span class="n">rospy</span><span class="o">.</span><span class="n">on_shutdown</span><span class="p">(</span><span class="n">traj</span><span class="o">.</span><span class="n">stop</span><span class="p">)</span>
<span class="lineno">347 </span>    <span class="n">result</span> <span class="o">=</span> <span class="bp">True</span>
<span class="lineno">348 </span>    <span class="n">loop_cnt</span> <span class="o">=</span> <span class="mi">1</span>
<span class="lineno">349 </span>    <span class="n">loopstr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">loops</span><span class="p">)</span>
<span class="lineno">350 </span>    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">loops</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<span class="lineno">351 </span>        <span class="n">args</span><span class="o">.</span><span class="n">loops</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>
<span class="lineno">352 </span>        <span class="n">loopstr</span> <span class="o">=</span> <span class="s2">&quot;forever&quot;</span>
<span class="lineno">353 </span>    <span class="k">while</span> <span class="p">(</span><span class="n">result</span> <span class="o">==</span> <span class="bp">True</span> <span class="ow">and</span> <span class="n">loop_cnt</span> <span class="o">&lt;=</span> <span class="n">args</span><span class="o">.</span><span class="n">loops</span>
<span class="lineno">354 </span>           <span class="ow">and</span> <span class="ow">not</span> <span class="n">rospy</span><span class="o">.</span><span class="n">is_shutdown</span><span class="p">()):</span>
<span class="lineno">355 </span>        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Playback loop </span><span class="si">%d</span><span class="s2"> of </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">loop_cnt</span><span class="p">,</span> <span class="n">loopstr</span><span class="p">,))</span>
<span class="lineno">356 </span>        <span class="n">traj</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="lineno">357 </span>        <span class="n">result</span> <span class="o">=</span> <span class="n">traj</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
<span class="lineno">358 </span>        <span class="n">loop_cnt</span> <span class="o">=</span> <span class="n">loop_cnt</span> <span class="o">+</span> <span class="mi">1</span>
<span class="lineno">359 </span>    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Exiting - File Playback Complete&quot;</span><span class="p">)</span>
<span class="lineno">360 </span>
<span class="lineno">361 </span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<span class="lineno">362 </span>    <span class="n">main</span><span class="p">()</span>
</pre></div>
<p>The node is initialized. An instance of the <code>Trajectory</code> class is created. <code>The parse_file()</code> method is called to extract the recorded Joint Positions and their corresponding timestamps as explained above. The <code>start()</code> method is called to send the <code>FollowJointTrajectory</code> request message to the <code>Joint Trajectory Action server</code>. This loops for the user specified number of times.
</p>
</div>

<!-- 
NewPP limit report
Cached time: 20191018040905
Cache expiry: 86400
Dynamic content: false
CPU time usage: 0.074 seconds
Real time usage: 0.076 seconds
Preprocessor visited node count: 182/1000000
Preprocessor generated node count: 628/1000000
Postexpand include size: 37/2097152 bytes
Template argument size: 1/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip postexpand size: 63239/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    0.671      1 Template:TOClimit
100.00%    0.671      1 -total
-->
</div>
<!-- Saved in parser cache with key interasdk:pcache:idhash:67-0!canonical and timestamp 20191018040905 and revision id 1171
 -->
</div><div class="printfooter">
Retrieved from "<a dir="ltr" href="a/index23d2.html?title=Joint_Trajectory_Playback_Example&amp;oldid=1171">http://sdk.rethinkrobotics.com/intera/a/index.php?title=Joint_Trajectory_Playback_Example&amp;oldid=1171</a>"</div>

            <div id="catlinks" class="catlinks catlinks-allhidden" data-mw="interface"></div>            <!-- end content -->

                        <div class="visualClear"></div>
        </div><!--/#bodyContent-->
    </div> <!-- /mainContent -->
</div><!--/.bg-wrapper
<!-- end fragment mainContent --></div><!-- /mBody --><div class="visualClear"></div><!-- start fragment footer -->        <div id="footer" role="contentinfo">
                <div id="f-poweredbyico">
                            <a href="http://www.mediawiki.org/"><img src="a/resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="/intera/a/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /intera/a/resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31"/></a>                    </div>
            <ul id="f-list">
                            <li id="copywrite_notice">&copy; 2019 Rethink Robotics. All rights reserved.</li>
                            <li id="special_pages"><a href="%e2%a7%bcspecialPagePage%e2%a7%bd.html" title="specialPagePage">Special page</a></li>
                            <li id="privacy"><a href="Intera_SDK_Privacy_policy.html" title="Intera SDK:Privacy policy">Privacy policy</a></li>
                            <li id="about"><a href="Intera_SDK_About.html" title="Intera SDK:About">About Intera SDK</a></li>
                            <li id="disclaimer"><a href="Intera_SDK_General_disclaimer.html" title="Intera SDK:General disclaimer">Disclaimers</a></li>
                    </ul><!--/#f-list-->
    </div><!-- end fragment footer --></div><script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgPageParseReport":{"limitreport":{"cputime":"0.074","walltime":"0.076","ppvisitednodes":{"value":182,"limit":1000000},"ppgeneratednodes":{"value":628,"limit":1000000},"postexpandincludesize":{"value":37,"limit":2097152},"templateargumentsize":{"value":1,"limit":2097152},"expansiondepth":{"value":2,"limit":40},"expensivefunctioncount":{"value":0,"limit":100},"unstrip-depth":{"value":0,"limit":20},"unstrip-size":{"value":63239,"limit":5000000},"timingprofile":["100.00%    0.671      1 Template:TOClimit","100.00%    0.671      1 -total"]},"cachereport":{"timestamp":"20191018040905","ttl":86400,"transientcontent":false}}});});</script><script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgBackendResponseTime":127});});</script></body>
<!-- Mirrored from sdk.rethinkrobotics.com/intera/Joint_Trajectory_Playback_Example by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 18 Oct 2019 05:04:07 GMT -->
</html>